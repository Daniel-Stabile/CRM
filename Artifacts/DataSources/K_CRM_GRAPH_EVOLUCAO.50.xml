<?xml version="1.0"?>
<DataSourcePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Identifier>K_CRM_GRAPH_EVOLUCAO</Identifier>
  <Name>CRM_GRAPH_EVOLUCAO</Name>
  <Content><![CDATA[<DataSourceDefinition>
  <FromSql Alias="A" SelectCommand="&#xD;&#xA;SELECT TAB.DATA,TAB.MES,TAB.ANO,&#xD;&#xA;       COALESCE(CC.CONTAS,0) CONTAS,&#xD;&#xA;       COALESCE(PP.PROSPECTS,0) PROSPECTS,&#xD;&#xA;       COALESCE(VIS.VISITAS,0) VISITAS,&#xD;&#xA;       COALESCE(OPO.OPORTUNIDADE,0) OPORTUNIDADES,&#xD;&#xA;       COALESCE(PRIMVIS.PRIM_VISITAS,0) PRIMVISITAS&#xD;&#xA;FROM (&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-11,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-11,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-11,GETDATE())) MES,YEAR(DATEADD(M,-11,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-10,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-10,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-10,GETDATE())) MES,YEAR(DATEADD(M,-10,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-9,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-9,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-9,GETDATE())) MES,YEAR(DATEADD(M,-9,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-8,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-8,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-8,GETDATE())) MES,YEAR(DATEADD(M,-8,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-7,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-7,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-7,GETDATE())) MES,YEAR(DATEADD(M,-7,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-6,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-6,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-6,GETDATE())) MES,YEAR(DATEADD(M,-6,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-5,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-5,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-5,GETDATE())) MES,YEAR(DATEADD(M,-5,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-4,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-4,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-4,GETDATE())) MES,YEAR(DATEADD(M,-4,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-3,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-3,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-3,GETDATE())) MES,YEAR(DATEADD(M,-3,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-2,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-2,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-2,GETDATE())) MES,YEAR(DATEADD(M,-2,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,DATEADD(M,-1,GETDATE())),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,DATEADD(M,-1,GETDATE())) AS VARCHAR) AS VARCHAR) DATA,MONTH(DATEADD(M,-1,GETDATE())) MES,YEAR(DATEADD(M,-1,GETDATE())) ANO&#xD;&#xA;    UNION&#xD;&#xA;    SELECT CAST(CAST(LEFT(DATENAME(MONTH,GETDATE()),3) AS VARCHAR) +'/'+ CAST(DATENAME(YEAR,GETDATE()) AS VARCHAR) AS VARCHAR) DATA,MONTH(GETDATE()) MES,YEAR(GETDATE()) ANO&#xD;&#xA;    ) TAB&#xD;&#xA;LEFT JOIN (&#xD;&#xA;    SELECT DISTINCT MONTH(DATAINCLUSAO) MES,YEAR(DATAINCLUSAO) ANO,COUNT(B.HANDLE) CONTAS&#xD;&#xA;    FROM K_CRM_PESSOAS B&#xD;&#xA;    WHERE 1=1&#xD;&#xA;    AND @CRITERIOSELECAO&#xD;&#xA;    GROUP BY MONTH(DATAINCLUSAO),YEAR(DATAINCLUSAO)) CC ON CC.MES = TAB.MES AND CC.ANO = TAB.ANO&#xD;&#xA;LEFT JOIN (&#xD;&#xA;    SELECT DISTINCT MONTH(DATACONCLUSAO) MES,YEAR(DATACONCLUSAO) ANO,COUNT(A.HANDLE) PROSPECTS&#xD;&#xA;    FROM K_CRM_TAREFAUSUARIO A&#xD;&#xA;    JOIN K_CRM_PESSOAS B ON A.PESSOA = B.HANDLE&#xD;&#xA;    WHERE 1=1&#xD;&#xA;    AND @CRITERIOSELECAO&#xD;&#xA;    AND A.RESPOSTA IN (&#xD;&#xA;        SELECT HANDLE&#xD;&#xA;        FROM K_CRM_TAREFARESPOSTAS&#xD;&#xA;        WHERE PROXIMASUBFASE IN (5,6))&#xD;&#xA;    GROUP BY MONTH(DATACONCLUSAO),YEAR(DATACONCLUSAO) ) PP ON PP.MES = TAB.MES AND PP.ANO = TAB.ANO&#xD;&#xA;LEFT JOIN (&#xD;&#xA;    SELECT DISTINCT MONTH(DATACONCLUSAO) MES,YEAR(DATACONCLUSAO) ANO,COUNT(A.HANDLE) VISITAS&#xD;&#xA;    FROM K_CRM_TAREFAUSUARIO A&#xD;&#xA;    JOIN K_CRM_PESSOAS B ON A.PESSOA = B.HANDLE&#xD;&#xA;    JOIN K_CRM_TAREFAS C ON A.TAREFA = C.HANDLE&#xD;&#xA;    WHERE 1=1&#xD;&#xA;    AND C.TIPO = 8&#xD;&#xA;    AND @CRITERIOSELECAO&#xD;&#xA;    AND RESPOSTA IN (201)&#xD;&#xA;    GROUP BY MONTH(DATACONCLUSAO),YEAR(DATACONCLUSAO) ) VIS ON VIS.MES = TAB.MES AND VIS.ANO = TAB.ANO&#xD;&#xA;LEFT JOIN (&#xD;&#xA;    SELECT DISTINCT MONTH(DATACONCLUSAO) MES,YEAR(DATACONCLUSAO) ANO,COUNT(A.HANDLE) PRIM_VISITAS&#xD;&#xA;    FROM K_CRM_TAREFAUSUARIO A&#xD;&#xA;    JOIN K_CRM_PESSOAS B ON A.PESSOA = B.HANDLE&#xD;&#xA;    JOIN K_CRM_TAREFAS C ON A.TAREFA = C.HANDLE&#xD;&#xA;    WHERE 1=1&#xD;&#xA;    AND C.TIPO = 9&#xD;&#xA;    AND @CRITERIOSELECAO&#xD;&#xA;    AND RESPOSTA IN (199)&#xD;&#xA;    GROUP BY MONTH(DATACONCLUSAO),YEAR(DATACONCLUSAO) ) PRIMVIS ON PRIMVIS.MES = TAB.MES AND PRIMVIS.ANO = TAB.ANO&#xD;&#xA;LEFT JOIN (&#xD;&#xA;    SELECT DISTINCT MONTH(DATACONCLUSAO) MES,YEAR(DATACONCLUSAO) ANO,COUNT(A.HANDLE) OPORTUNIDADE&#xD;&#xA;    FROM K_CRM_TAREFAUSUARIO A&#xD;&#xA;    JOIN K_CRM_PESSOAS B ON A.PESSOA = B.HANDLE&#xD;&#xA;    WHERE 1=1&#xD;&#xA;    AND @CRITERIOSELECAO&#xD;&#xA;    AND RESPOSTA IN (204,230)&#xD;&#xA;    GROUP BY MONTH(DATACONCLUSAO),YEAR(DATACONCLUSAO) ) OPO ON OPO.MES = TAB.MES AND OPO.ANO = TAB.ANO&#xD;&#xA;GROUP BY TAB.DATA,TAB.MES,TAB.ANO,CC.CONTAS,PP.PROSPECTS,VIS.VISITAS,OPO.OPORTUNIDADE,PRIMVIS.PRIM_VISITAS&#xD;&#xA;ORDER BY TAB.ANO,TAB.MES" />
  <Fields>
    <Field Alias="DATA" From="A" Path="DATA" />
    <Field Alias="MES" From="A" Path="MES" />
    <Field Alias="ANO" From="A" Path="ANO" />
    <Field Alias="CONTAS" From="A" Path="CONTAS" />
    <Field Alias="PROSPECTS" From="A" Path="PROSPECTS" />
    <Field Alias="VISITAS" From="A" Path="VISITAS" />
    <Field Alias="OPORTUNIDADES" From="A" Path="OPORTUNIDADES" />
    <Field Alias="PRIMVISITAS" From="A" Path="PRIMVISITAS" />
  </Fields>
</DataSourceDefinition>
]]></Content>
  <Level>Cliente</Level>
  <ContemDadosPessoaisLgpd>false</ContemDadosPessoaisLgpd>
  <ExibirNaApi>true</ExibirNaApi>
</DataSourcePortable>