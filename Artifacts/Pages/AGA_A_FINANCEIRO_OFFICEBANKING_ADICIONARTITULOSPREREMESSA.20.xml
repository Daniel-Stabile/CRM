<?xml version="1.0"?>
<PagePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Title>Parcelas</Title>
  <Url>~/aga/a/Financeiro/OfficeBanking/AdicionarTitulosPreRemessa.aspx</Url>
  <AutoGenerated>true</AutoGenerated>
  <EntityPermissionId />
  <TemplateId />
  <Details />
  <Id>AGA_A_FINANCEIRO_OFFICEBANKING_ADICIONARTITULOSPREREMESSA</Id>
  <Level>Benner</Level>
  <CodeFile />
  <CodeInherits>aga.a.Financeiro.OfficeBanking.AdicionarTitulosPreRemessa,Benner.Corporativo.Wes.WebApp</CodeInherits>
  <Widgets>
    <PageWidgetPortable>
      <Id>PARCELAS</Id>
      <Title>Parcelas</Title>
      <Order>10</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>FN_PARCELAS.SELECIONARTITULOSPREREMESSA.CUSTOM.GRID</EntityViewName>
  <DefaultFilterName>Padrão</DefaultFilterName>
  <Mode>2</Mode>
  <UserDefinedSelectColumnVisible>true</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.HANDLE IN (SELECT P.HANDLE
		FROM FN_PARCELAS P JOIN FN_DOCUMENTOS DOC ON P.DOCUMENTO = DOC.HANDLE
		WHERE (DOC.OPERACAOCANCELAMENTO IS NULL) AND
		(P.DOCUMENTOSUSPENSO = 'N') AND
		(P.PERMUTA = 'N') AND
		(DOC.EHPREVISAO = 'N') AND
		(P.PERMITIRBAIXARPELATESOURARIA = 'S')  AND
		((DOC.ENTRADASAIDA = 'E' AND DOC.TIPODEMOVIMENTO IN (1, 2)) OR (DOC.ENTRADASAIDA = 'E' AND DOC.TIPODEMOVIMENTO = 3)) AND
		(P.EMABERTO = 'S') AND
		(P.PREVISAO &lt;&gt; 'S') AND
		(P.REMESSA IS NULL) AND
                (P.PREREMESSA IS NULL))
</UserDefinedCriteriaWhereClause>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
  </Widgets>
  <Resources>
    <PageResourcePortable>
      <Id>184C53DA56D44B5B91B19984F92DB1A9</Id>
      <ResourceType>JavaScript</ResourceType>
      <Content><![CDATA[$(function(){
    var pagina = Sys.WebForms.PageRequestManager.getInstance();
	if (!pagina.get_isInAsyncPostBack()) {
		pagina.add_endRequest(AjustarCamposFiltro);
	}
    __doPostBack('ctl00$Main$PARCELAS$ClearButton','');
    Sys.Application.add_init(appl_init);
	AjustarCamposFiltro();
});

function AjustarCamposFiltro() {
    var buscaAvancada = $('#ctl00_Main_TTULOS_GERAL_BUSCAAVANCADA');
    buscaAvancada.css('border-bottom', '2px solid #a0c2ec');
    buscaAvancada.css('font-weight', '500');
    
    var tituloDocumentos = $('#ctl00_Main_TTULOS_GERAL_TIPOSDOCUMENTO');
    var camposDocumentos = tituloDocumentos.parent().children('.row');
    tituloDocumentos.css('font-size', '16px');
    tituloDocumentos.css('border-bottom', 'none');
    tituloDocumentos.css('margin-bottom', '10px');
    camposDocumentos.css('margin-bottom', '-30px');
    camposDocumentos.css('margin-top', '-30px');
    
    $('th[data-field="VALORLIQUIDOCALCULADO"]').removeClass('text-left').addClass('text-right');
}

function beforeAsyncPostBack() {
    // nada aqui
}

function inicializaCMD_ADICIONAR() {
    comando = '<i class="fa fa-plus btn-action"></i>';
    comando += ' Adicionar selecionados';
    $('#top-CMD_ADICIONAR').html(comando);
    $("#ctl00_Main_PARCELAS_footerCommands").children().html(comando)
}

function afterAsyncPostBack() {
    // no clique de um input checkbox
    $('input[type="checkbox"]').on('click', function () {
        
        // seta o padrão do comando adicionar
        inicializaCMD_ADICIONAR();
        
        // zera a variável que controla o valor
        var valorTotal = 0;
        
        // para cada checkbox, que esteja checado, que não seja o checkbox que marca todos
        $('input[type="checkbox"]:checked:not(#ctl00_Main_PARCELAS_SimpleGrid_ctl01_SelectAllCheckBoxHeader)').each(function(){
            // busca o TR do checkbox
        	parentTR = $(this).parents('tr:eq(0)');
        	
        	// busca o primeiro TD do tipo currency (campo Valor)
        	TDValor = $(parentTR).children('.campoValorLiquidoCalculado:first');
        	
            // busca o texto do filho do TD e remove o cifrão
            strValor = $(TDValor).children().text().replace(/[R$\s]+/, '');
            // remove o ponto
            strValor = strValor.replaceAll('.', '');
            strValor = strValor.replace(',', '.');

            // converte
            var valorSelecionado = parseFloat(strValor);
            valorTotal +=!isNaN(valorSelecionado) ? valorSelecionado : 0;
                    
        	// se possui valor, monta um novo html pro CMD_ADICIONAR
            if (valorTotal > 0)
            {
                valorFormatado = (valorTotal).toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL',
                });
                comando = '<i class="fa fa-plus btn-action"></i>';
                comando += ' Adicionar selecionados';
                comando += ' (' + valorFormatado + ')';

            	$('#top-CMD_ADICIONAR').html(comando);
            	$("#ctl00_Main_PARCELAS_footerCommands").children().html(comando)
            }
        });
    });
    
}

function appl_init() {
    var pgRegMgr = Sys.WebForms.PageRequestManager.getInstance();
    pgRegMgr.add_beginRequest(BeginHandler);
    pgRegMgr.add_endRequest(EndHandler);
}

function BeginHandler() {
    beforeAsyncPostBack();
}

function EndHandler() {           
    afterAsyncPostBack();
}
]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
  </Resources>
</PagePortable>