<?xml version="1.0"?>
<PagePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Title>Aglutinador Documentos CPA</Title>
  <Url>~/Erp/Financeiro/AglutinadorCPA/Geral.aspx</Url>
  <AutoGenerated>true</AutoGenerated>
  <EntityPermissionId />
  <TemplateId />
  <Details />
  <Id>ERP_FINANCEIRO_AGLUTINADORCPA_GERAL</Id>
  <Level>Benner</Level>
  <CodeFile>~/Erp/Financeiro/AglutinadorCPA/Geral.aspx.cs</CodeFile>
  <CodeInherits>AglutinadorCPAGeralPage</CodeInherits>
  <Widgets>
    <PageWidgetPortable>
      <Id>DOCUMENTOS</Id>
      <Title>Contas a pagar</Title>
      <Order>10</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>false</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>FN_DOCUMENTOS.AGLUTINADORCPA.GRID</EntityViewName>
  <DefaultFilterName>Padr√£o aglutinador</DefaultFilterName>
  <Mode>4</Mode>
  <UserDefinedSelectColumnVisible>true</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <FormUrl>~/aga/a/materiais/recebimentoFisico/entregaItemOrdemCompra.aspx</FormUrl>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
  </Widgets>
  <Resources>
    <PageResourcePortable>
      <Id>B65511D1696E43BDA453B6D069E41C35</Id>
      <ResourceType>JavaScript</ResourceType>
      <Content><![CDATA[ function afterAsyncPostBack() {
            $('input[type="checkbox"]').on('click', function () {
                inicializaCMD_SALVAR();
                var valorTotal = 0;
                $('input[type="checkbox"]:checked:not(#ctl00_Main_PARCELAS_SimpleGrid_ctl01_SelectAllCheckBoxHeader)').each(function () {
                    if(this.name.includes('CONTABILIZADO') || this.id == 'ctl00_Main_DOCUMENTOS_SimpleGrid_ctl01_SelectAllCheckBoxHeader')
                      return;
                    parentTR = $(this).parents('tr:eq(0)');
                    debugger;
                    TDValor = $(parentTR).children('td[data-field="VALORLIQUIDO"]:first');
                    TDValorBaixado = $(parentTR).children('td[data-field="VALORESBAIXADOS"]:first');

                    strValor = $(TDValor).children().text().replace(/[R$\s]+/, '');
                    strValor = strValor.replaceAll('.', '');
                    strValor = strValor.replace(',', '.');
                    
                    strValorBaixado = $(TDValorBaixado).children().text().replace(/[R$\s]+/, '');
                    strValorBaixado = strValorBaixado.replaceAll('.', '');
                    strValorBaixado = strValorBaixado.replace(',', '.');

                    valorTotal += parseFloat(strValor) - parseFloat(strValorBaixado);;
                    if (valorTotal > 0) {
                        valorFormatado = 'R$ ' + mascaraValor(valorTotal.toFixed(2));
                        $(".btn.command-action.custom-action.blue").each(function(btn){
                         this.innerHTML = "<i class='fa fa-check btn-action'></i> Aglutinar (" + valorFormatado + ")";
                        })
                    }
                });
            });
          }

          $(function(){
            afterAsyncPostBack();
          })

          function inicializaCMD_SALVAR() {
               $(".btn.command-action.custom-action.blue").each(function(btn){
				this.innerHTML = "<i class='fa fa-check btn-action'></i> Aglutinar"
            })
          }

          function mascaraValor(valor) {
              valor = valor.toString().replace(/\D/g, "");
              valor = valor.toString().replace(/(\d)(\d{8})$/, "$1.$2");
              valor = valor.toString().replace(/(\d)(\d{5})$/, "$1.$2");
              valor = valor.toString().replace(/(\d)(\d{2})$/, "$1,$2");
              return valor;
          }
          Sys.Application.add_init(appl_init);
          function appl_init() {
            var pgRegMgr = Sys.WebForms.PageRequestManager.getInstance();
            pgRegMgr.add_beginRequest(EndHandler);
            pgRegMgr.add_endRequest(EndHandler);
          }

          function EndHandler() {
            afterAsyncPostBack();
          }]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
  </Resources>
</PagePortable>