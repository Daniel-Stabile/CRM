<?xml version="1.0"?>
<PagePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Title>Nova cobrança bancária</Title>
  <Url>~/aga/e/financeiro/cobrancabancaria/Inserir.aspx</Url>
  <AutoGenerated>false</AutoGenerated>
  <EntityPermissionId />
  <TemplateId>WIZARD</TemplateId>
  <Details />
  <Id>WEB_E_FINANCEIRO_COBRANCA_INSERIR_FORM</Id>
  <Level>Benner</Level>
  <CodeFile>~/aga/e/financeiro/cobrancabancaria/Inserir.aspx.cs</CodeFile>
  <CodeInherits>InserirCobrancaBancariaPage</CodeInherits>
  <Widgets>
    <PageWidgetPortable>
      <Id>FORMNOVACOBRANCABANCARIA</Id>
      <Title>Nova cobrança bancária</Title>
      <Order>10</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>AjaxForm</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<AjaxFormAttributes>
  <EntityViewName>WEB_FN_INSERIRCOBRANCABANCARIA.FORM</EntityViewName>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <IncludeRecordInRecentItems>true</IncludeRecordInRecentItems>
  <UserDefinedCommandsVisible>true</UserDefinedCommandsVisible>
</AjaxFormAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>GRIDSELECIONEASPARCELAS</Id>
      <Title>Selecione as parcelas</Title>
      <Order>20</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>WEB_FN_COBRANCABANC_TITULOS_OCORRENCIAS.DATASOURCE.GRID</EntityViewName>
  <Mode>1</Mode>
  <UserDefinedSelectColumnVisible>true</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
  </Widgets>
  <Resources>
    <PageResourcePortable>
      <Id>432DB8940CAF403BA3DA6119C7858F84</Id>
      <ResourceType>JavaScript</ResourceType>
      <Content><![CDATA[$(function () {

	$('#form_wizard').bootstrapWizard({
		onTabClick: function (tab, navigation, index, clickedIndex) {
			return false;
		},
		onNext: function (tab, navigation, index) { },
		onPrevious: function (tab, navigation, index) { },
		onTabShow: function (tab, navigation, index) {
			var total = navigation.find('li').length;
			var current = index + 1;
			var $percent = (current / total) * 100;
			$('#form_wizard').find('.progress-bar').css({
				width: $percent + '%'
			});
		}
	});


	selectCurrentStep = function () {
		var currentStep = $("#CurrentStep").val();
		$('[href="#tab' + currentStep + '"]').tab('show');
	};

	var prm = Sys.WebForms.PageRequestManager.getInstance();
	if (!prm.get_isInAsyncPostBack()) {
		prm.add_endRequest(function (sender, args) {
			selectCurrentStep();
			AlterarExportarPlanilhaJS();
		});
	}
	selectCurrentStep();
});


function AlterarExportarPlanilhaJS() {
	$('#ctl00_Main_PARCELAS_SimpleGrid_ctl01_ExportToExcel').attr('href', '#');

	$('#ctl00_Main_PARCELAS_SimpleGrid .fa-download').closest('a').click(function (e) {
        e.preventDefault();
        var nomePlanilha = 'Parcelas_' + GerarIdRamdomico() + '.xls';
		ExportarPlanilha($('#ctl00_Main_PARCELAS_SimpleGrid'), nomePlanilha, 'ParcelasRemessa');
	})
}

        function afterAsyncPostBack() {
            
            // no clique de um input checkbox
            $('input[type="checkbox"]').on('click', function () {
                inicializaCMD_SALVAR();
                // zera a variável que controla o valor
                var valorTotal = 0;
                // para cada checkbox, que esteja checado, que não seja o checkbox que marca todos
                $('input[type="checkbox"]:checked:not(#ctl00_Main_PARCELAS_SimpleGrid_ctl01_SelectAllCheckBoxHeader)').each(function () {
                    // busca o TR do checkbox
                    parentTR = $(this).parents('tr:eq(0)');

                    // busca o primeiro TD do tipo currency (campo Valor)
                    TDValor = $(parentTR).children('td[data-type="number"]:first');

                    // busca o texto do filho do TD e remove o cifrão
                    strValor = $(TDValor).children().text().replace(/[R$\s]+/, '');
                    // remove o ponto
                    strValor = strValor.replace('.', '');
					strValor = strValor.replace(',', '.');

                    // converte
                    valorTotal += parseFloat(strValor);
                    // se possui valor, monta um novo html pro CMD_ADICIONAR
                    if (valorTotal > 0) {
                        valorFormatado = 'R$ ' + mascaraValor(valorTotal.toFixed(2));
                        $("#top-CMD_OK").html("<i class='fa fa-check btn-action'></i> Salvar (" + valorFormatado + ")");
                    }
                });
            });

        }

        function inicializaCMD_SALVAR() {
            $("#top-CMD_OK").html("<i class='fa fa-check btn-action'></i> Salvar")
        }

        function mascaraValor(valor) {
            valor = valor.toString().replace(/\D/g, "");
            valor = valor.toString().replace(/(\d)(\d{8})$/, "$1.$2");
            valor = valor.toString().replace(/(\d)(\d{5})$/, "$1.$2");
            valor = valor.toString().replace(/(\d)(\d{2})$/, "$1,$2");
            return valor;
        }

        Sys.Application.add_init(appl_init);
        function appl_init() {
            var pgRegMgr = Sys.WebForms.PageRequestManager.getInstance();
            pgRegMgr.add_endRequest(EndHandler);
        }

        function EndHandler() {
            afterAsyncPostBack();
        }
]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
  </Resources>
</PagePortable>