<?xml version="1.0"?>
<PagePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Title>Requisições</Title>
  <Url>~/aga/a/Suprimentos/Requisicoes/RequisicaoGrid.aspx</Url>
  <AutoGenerated>true</AutoGenerated>
  <EntityPermissionId />
  <TemplateId />
  <Details />
  <Id>AGA_A_SUPRIMENTOS_REQUISICOES_REQUISICAOGRID</Id>
  <Level>Benner</Level>
  <CodeFile />
  <CodeInherits>Benner.Corporativo.Wes.WebApp.aga.a.suprimentos.requisicao.RequisicaoGrid</CodeInherits>
  <Widgets>
    <PageWidgetPortable>
      <Id>REQUISICES</Id>
      <Title>Requisicões</Title>
      <Order>10</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CP_REQUISICOESPAI.REQUISICAO.GRID</EntityViewName>
  <DefaultFilterName>Padrão</DefaultFilterName>
  <Mode>1</Mode>
  <UserDefinedSelectColumnVisible>true</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.FILIAL IN @FILIAIS AND (A.USUARIOINCLUIU = @USUARIO OR (SELECT HANDLE FROM Z_TAREFAS WHERE NOME = 'VISUALIZARREQUISICAOTODOSUSUARIOS') IN @TAREFAS)</UserDefinedCriteriaWhereClause>
  <FormUrl>~/aga/a/Suprimentos/Requisicoes/Requisicao.aspx</FormUrl>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>ITENSDAREQUISIO</Id>
      <MasterWidgetId>REQUISICES</MasterWidgetId>
      <Title>Itens da requisição</Title>
      <Order>20</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>6</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>false</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>CP_REQUISICOES.GRPACOES.ITENSDAREQUISICAO.GRID</EntityViewName>
  <Mode>0</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>false</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.REQUISICAOPAI = @CAMPO(HANDLE)</UserDefinedCriteriaWhereClause>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>ANEXOS</Id>
      <MasterWidgetId>REQUISICES</MasterWidgetId>
      <Title>Anexos</Title>
      <Order>30</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>6</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CP_REQUISICAOPAIANEXOS.GRPACOES.ANEXOS.GRID</EntityViewName>
  <Mode>0</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>false</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.REQUISICAOPAI = @CAMPO(HANDLE)</UserDefinedCriteriaWhereClause>
  <FormUrl>~/aga/a/Suprimentos/Requisicoes/Anexos.aspx</FormUrl>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>HISTRICO</Id>
      <MasterWidgetId>REQUISICES</MasterWidgetId>
      <Title>Histórico</Title>
      <Order>40</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>6</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>false</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>PD_STATUS.REQUISICOES.GRPACOES.HISTORICO.GRID</EntityViewName>
  <Mode>0</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>false</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.HANDLETABELAORIGEM IN (SELECT B.HANDLE FROM Z_TABELAS B WHERE B.NOME = 'CP_REQUISICOESPAI') AND A.HANDLEREGISTROORIGEM = @CAMPO(HANDLE)</UserDefinedCriteriaWhereClause>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>HISTRICODEASSINATURAS</Id>
      <MasterWidgetId>REQUISICES</MasterWidgetId>
      <Title>Histórico de assinaturas</Title>
      <Order>50</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>AjaxForm</WidgetTypeId>
      <BootstrapCols>6</BootstrapCols>
      <XmlAttributes><![CDATA[<AjaxFormAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>false</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>CP_REQUISICOESPAI.GRPACOES.HISTORICODEASSINATURAS.FORM</EntityViewName>
  <FormMode>2</FormMode>
  <IncludeRecordInRecentItems>true</IncludeRecordInRecentItems>
  <UserDefinedCommandsVisible>false</UserDefinedCommandsVisible>
</AjaxFormAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
  </Widgets>
  <Resources>
    <PageResourcePortable>
      <Id>D29BEB3A69394541A1286B7997E8E54E</Id>
      <ResourceType>JavaScript</ResourceType>
      <Content><![CDATA[$(() => {
    $('#ctl00_Main_REQUISICES .tools').prepend('<div class="btn-group" data-toggle="buttons"><label class="btn blue active" onclick="exibirFiltro();" id="labelExibirFiltroRequisicoes"><input type="radio" id="toggleExibirFiltro" name="toggleFiltro" class="toggle"> Exibir filtro </label><label style="margin-left: 3px;" class="btn blue" onclick="ocultarFiltro(true);" id="labelOcultarFiltroRequisicoes"><input type="radio" id="toggleOcultarFiltroRequisicoes" name="toggleFiltro" class="toggle"> Ocultar filtro </label></div>');

    $('#ctl00_Main_ITENSDAREQUISIO .tools').prepend('<div class="btn-group" data-toggle="buttons"><a id="top-OcultarItensRequisicao" class="btn command-action custom-action btn command-action blue" style="" onclick="ocultarGridItensRequisicao()"><i class="fa fa-arrow-left btn-action"></i> Ocultar</a></div>');
	
    $('#ctl00_Main_ANEXOS .tools').prepend('<div class="btn-group" data-toggle="buttons"><a id="top-OcultarAnexos" class="btn command-action custom-action btn command-action blue" style="" onclick="ocultarGridAnexos()"><i class="fa fa-arrow-left btn-action"></i> Ocultar</a></div>');
	
    $('#ctl00_Main_HISTRICO .tools').prepend('<div class="btn-group" data-toggle="buttons"><a id="top-OcultarHistorico" class="btn command-action custom-action btn command-action blue" style="" onclick="ocultarGridHistorico()"><i class="fa fa-arrow-left btn-action"></i> Ocultar</a></div>');
	
    $('#ctl00_Main_HISTRICODEASSINATURAS .tools').prepend('<div class="btn-group" data-toggle="buttons"><a id="top-OcultarHistoricoDeAssinaturas" class="btn command-action custom-action btn command-action blue" style="" onclick="ocultarFormHistoricoDeAssinaturas()"><i class="fa fa-arrow-left btn-action"></i> Ocultar</a></div>');	
    
    var pagina = Sys.WebForms.PageRequestManager.getInstance();
    
    if (!pagina.get_isInAsyncPostBack())
    {
        pagina.add_endRequest(processarVisibilidadeFiltro);
        pagina.add_endRequest(desfazerBotaoMaisTec);
        pagina.add_endRequest(processarVisibilidadeGridItensRequisicao);
		pagina.add_endRequest(processarVisibilidadeGridAnexos);
		pagina.add_endRequest(processarVisibilidadeGridHistorico);
		pagina.add_endRequest(processarVisibilidadeFormHistoricoDeAssinaturas);
        pagina.add_endRequest(ocultarPainelComandosInferior);
		pagina.add_endRequest(redimencionarGridRequisicoes);
    }
    
    processarVisibilidadeFiltro();
    processarVisibilidadeGridItensRequisicao();
	processarVisibilidadeGridAnexos();
	processarVisibilidadeGridHistorico();
	processarVisibilidadeFormHistoricoDeAssinaturas();
    ocultarPainelComandosInferior();
	redimencionarGridRequisicoes();
});

const ocultarPainelComandosInferior = () => Benner.Page.REQUISICES.hideFooterCommandsBar();

//A barra de comandos da tec possui javascript que implementa controle de largura automático por baixo dos panos, acionando o comando "Mais" e ocultando os comandos quando os mesmos forem sobrepassar a largura do widget. Nesta tela, porém, os comandos estão sendo diminuidos manualmente após a renderização, não sendo necessário esse comportamento. Este código oculta o botão mais caso a tec tenha inserido em seu JS por falso positivo e reexibe os comandos que foram ocultados.
const desfazerBotaoMaisTec = () => {
    $("#ctl00_Main_REQUISICES_toolbar a[style*='display: none']").show()
    $("#ctl00_Main_REQUISICES_toolbar .more-menu-item").hide()  
};

const diminuirComandosTabela = () => {
    $("#ctl00_Main_REQUISICES_toolbar, #ctl00_Main_REQUISICES_footerCommands").find("> a").each((index, comando) => {
        var descricaoComando = $(comando).text();
        $(comando).html($(comando).html().replace(descricaoComando, ""));
        $(comando).find("i").css("padding-left", "8px");
        
        if (!$(comando).attr("title"))
            $(comando).attr("title", descricaoComando);
    });  
};

const ocultarFiltro = (fadeOut) => {
    if (fadeOut)
        $('#ctl00_Main_REQUISICES_FilterControl_FilterContainer').fadeOut(500);
    else
        $('#ctl00_Main_REQUISICES_FilterControl_FilterContainer').hide();
    
    $('#toggleOcultarFiltroRequisicoes').prop('checked', true);
    $('#labelOcultarFiltroRequisicoes').addClass('active');
    $('#labelExibirFiltroRequisicoes').removeClass('active');
    
    sessionStorage.setItem('TOGGLE_FILTRO_REQUISICES', "Oculto");
};

const exibirFiltro = () => {
    $('#ctl00_Main_REQUISICES_FilterControl_FilterContainer').fadeIn(500);
    sessionStorage.setItem('TOGGLE_FILTRO_REQUISICES', "Visivel");
    $("#HasFilterApplied_Requisicoes").val("False");
};

const processarVisibilidadeFiltro = () => {
    var estadoFiltro = sessionStorage.getItem('TOGGLE_FILTRO_REQUISICES');
    
    if (estadoFiltro === "Oculto" || $("#HasFilterApplied_Requisicoes").val() == "True")
        ocultarFiltro();  
};

const redimencionarGridRequisicoes = () => {
	if ($("#VisibilidadeGridItensRequisicao").val() == "True" || $("#VisibilidadeGridAnexos").val() == "True" || $("#VisibilidadeGridHistorico").val() == "True" || $("#VisibilidadeFormHistoricoDeAssinaturas").val() == "True") {
		$('#REQUISICES').removeClass('col-md-12');
		$('#REQUISICES').addClass('col-md-6');
	} else {
		$('#REQUISICES').removeClass('col-md-6');
		$('#REQUISICES').addClass('col-md-12');
	}
}

const exibirGridItensRequisicao = () => {
	$("#ITENSDAREQUISIO").fadeIn();
	$("#VisibilidadeGridItensRequisicao").val("True");
	$("#VisibilidadeGridAnexos").val("False");
	$("#VisibilidadeGridHistorico").val("False");
	$("#VisibilidadeFormHistoricoDeAssinaturas").val("False");	
};

const ocultarGridItensRequisicao = () => {
	$("#ITENSDAREQUISIO").hide();
	$("#VisibilidadeGridItensRequisicao").val("False");
	redimencionarGridRequisicoes();
};

const exibirGridAnexos = () => {
	$("#ANEXOS").fadeIn();
	$("#VisibilidadeGridItensRequisicao").val("False");
	$("#VisibilidadeGridAnexos").val("True");	
	$("#VisibilidadeGridHistorico").val("False");
	$("#VisibilidadeFormHistoricoDeAssinaturas").val("False");
};

const ocultarGridAnexos = () => {
	$("#ANEXOS").hide();
	$("#VisibilidadeGridAnexos").val("False");
	redimencionarGridRequisicoes();
};

const exibirGridHistorico = () => {
	$("#HISTRICO").fadeIn();
	$("#VisibilidadeGridItensRequisicao").val("False");
	$("#VisibilidadeGridAnexos").val("False");
	$("#VisibilidadeGridHistorico").val("True");		
	$("#VisibilidadeFormHistoricoDeAssinaturas").val("False");
};

const ocultarGridHistorico = () => {
	$("#HISTRICO").hide();
	$("#VisibilidadeGridHistorico").val("False");
	redimencionarGridRequisicoes();
};

const exibirFormHistoricoDeAssinaturas = () => {
	$("#HISTRICODEASSINATURAS").fadeIn();
	$("#VisibilidadeGridItensRequisicao").val("False");
	$("#VisibilidadeGridAnexos").val("False");
	$("#VisibilidadeGridHistorico").val("False");
	$("#VisibilidadeFormHistoricoDeAssinaturas").val("True");
};

const ocultarFormHistoricoDeAssinaturas = () => {
	$("#HISTRICODEASSINATURAS").hide();
	$("#VisibilidadeFormHistoricoDeAssinaturas").val("False");
	redimencionarGridRequisicoes();
};

const processarVisibilidadeGridItensRequisicao = () => {
    if ($("#VisibilidadeGridItensRequisicao").val() == "False")
        ocultarGridItensRequisicao();
    else {
        exibirGridItensRequisicao();
		ocultarGridAnexos();
		ocultarGridHistorico();
		ocultarFormHistoricoDeAssinaturas();
	}
};

const processarVisibilidadeGridAnexos = () => {
    if ($("#VisibilidadeGridAnexos").val() == "False")
        ocultarGridAnexos();
    else {
        exibirGridAnexos();
		ocultarGridItensRequisicao();
		ocultarGridHistorico();
		ocultarFormHistoricoDeAssinaturas();
	}
};

const processarVisibilidadeGridHistorico = () => {
    if ($("#VisibilidadeGridHistorico").val() == "False")
        ocultarGridHistorico();
    else {
        exibirGridHistorico();
		ocultarGridItensRequisicao();
		ocultarGridAnexos();
		ocultarFormHistoricoDeAssinaturas();
	}
};

const processarVisibilidadeFormHistoricoDeAssinaturas = () => {
    if ($("#VisibilidadeFormHistoricoDeAssinaturas").val() == "False")
        ocultarFormHistoricoDeAssinaturas();
    else {
        exibirFormHistoricoDeAssinaturas();
		ocultarGridItensRequisicao();
		ocultarGridAnexos();
		ocultarGridHistorico();
	}
};]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
    <PageResourcePortable>
      <Id>670E8EC68B3A4CF486B29393238D6E98</Id>
      <ResourceType>CSS</ResourceType>
      <Content><![CDATA[#REQUISICES th, td {
    white-space:nowrap !important;
}

#ANEXOS th, td {
    white-space:nowrap !important;
}]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
  </Resources>
</PagePortable>