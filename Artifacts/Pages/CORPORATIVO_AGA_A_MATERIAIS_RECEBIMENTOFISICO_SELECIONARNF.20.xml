<?xml version="1.0"?>
<PagePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Title>Seleção de notas fiscais</Title>
  <Url>~/aga/a/materiais/recebimentoFisico/selecionarNF.aspx</Url>
  <AutoGenerated>true</AutoGenerated>
  <EntityPermissionId />
  <TemplateId />
  <Details />
  <Id>CORPORATIVO_AGA_A_MATERIAIS_RECEBIMENTOFISICO_SELECIONARNF</Id>
  <Level>Benner</Level>
  <CodeFile />
  <CodeInherits>Benner.Corporativo.Wes.WebApp.aga.a.materiais.recebimentoFisico.SelecionarNF</CodeInherits>
  <Widgets>
    <PageWidgetPortable>
      <Id>SELECIONAROSITENSPARADEVOLUODECLIENTES_1</Id>
      <Title>Seleção de itens</Title>
      <Order>5</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>AjaxForm</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<AjaxFormAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>PD_VTSELECIONARNF.RECEBIMENTOFISICO.FORM</EntityViewName>
  <FormMode>0</FormMode>
  <IncludeRecordInRecentItems>true</IncludeRecordInRecentItems>
  <UserDefinedCommandsVisible>true</UserDefinedCommandsVisible>
</AjaxFormAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>ITENS</Id>
      <Title>Itens</Title>
      <Order>30</Order>
      <ShowTitle>false</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Fixed</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>CM_ITENS.ITEM.GRID</EntityViewName>
  <Mode>0</Mode>
  <UserDefinedSelectColumnVisible>true</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>true</UserDefinedDisableRowSelection>
</SimpleGridAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>LOTES</Id>
      <MasterWidgetId>ITENS</MasterWidgetId>
      <Title>Lotes</Title>
      <Order>40</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>false</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>CM_ITEMENTREGALOTES.RECEBIMENTO.GRID</EntityViewName>
  <Mode>0</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>1000</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.ITEMENTREGA IN (SELECT HANDLE FROM CM_ITEMENTREGAS WHERE ITEM = @CAMPO(HANDLE))</UserDefinedCriteriaWhereClause>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>true</UserDefinedDisableRowSelection>
</SimpleGridAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
  </Widgets>
  <Resources>
    <PageResourcePortable>
      <Id>433F4A2B848B4C1894C92C5456FF0DA9</Id>
      <ResourceType>JavaScript</ResourceType>
      <Content><![CDATA[function AtualizarQuantidades() 
{
    var totalInformado = 0;
    
    $("#ctl00_Main_LOTES_SimpleGrid input[name*='QTDEEDITAVEL']").each(
    function() 
            {
                totalInformado += Number($(this).val().replace(",", "."));
            }
        );
    
    var lotesContados = $("#ctl00_Main_LOTES_SimpleGrid input[name*='QTDEEDITAVEL']").length;
    
    if (lotesContados > 0) 
    {
        $("#ctl00_Main_LOTES_SimpleGrid input[name*='QTDEEDITAVEL']").blur(AtualizarQuantidades);
        var handleItem = $("#ctl00_Main_LOTES_SimpleGrid input[name*='QTDEEDITAVEL']").attr('name').split('$')[6];
        var quantidadeTotal = totalInformado.toFixed(4).replace(".", ",");
        $("tr[handle='" + handleItem + "'] #QUANTIDADE").val(quantidadeTotal);
        
        var listaItens = ($("#CAMPOQUANTIDADELOTE").val().length > 0) ?
            $.parseJSON($("#CAMPOQUANTIDADELOTE").val()) : [];
        var listaLotes = [];
        
        $("#ctl00_Main_LOTES_SimpleGrid input[name*='QTDEEDITAVEL']").map(
            function() { listaLotes.push({
                    HandleLote: $(this).attr('name').split('$')[7],
                    Quantidade: Number($(this).val().replace(",", "."))
                });
            }
        );
        
        var indexItemSeExistir = listaItens.findIndex(item => item.HandleItem === handleItem);
        
        if (indexItemSeExistir > -1)
        {
            listaItens[indexItemSeExistir].Lotes = listaLotes;
            listaItens[indexItemSeExistir].QtdeTotal = totalInformado;
        }
        else
        {
            listaItens.push({
                HandleItem: handleItem, 
                Lotes: listaLotes, 
                QtdeTotal: totalInformado
            });
        }
        
        $("#CAMPOQUANTIDADELOTE").val(JSON.stringify(listaItens));
    }
}
]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
    <PageResourcePortable>
      <Id>0C6C61D0500F44F1A352E6C79BD0BFB0</Id>
      <ResourceType>CSS</ResourceType>
      <Content><![CDATA[.checkBoxEditavel{
    margin-top: 1px !important;
    margin-bottom: 1px !important;
}
]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
  </Resources>
</PagePortable>