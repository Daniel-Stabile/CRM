<?xml version="1.0"?>
<PagePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Title>Atendimento de requisição</Title>
  <Url>~/aga/a/materiais/requisicoes/atendimentoDeRequisicao.aspx</Url>
  <AutoGenerated>true</AutoGenerated>
  <EntityPermissionId />
  <TemplateId />
  <Details />
  <Id>AGA_A_MATERIAIS_REQUISICOES_ATENDIMENTODEREQUISICAO</Id>
  <Level>Benner</Level>
  <CodeFile />
  <CodeInherits>Benner.Corporativo.Wes.WebApp.aga.a.materiais.AtendimentoDeRequisicao</CodeInherits>
  <Widgets>
    <PageWidgetPortable>
      <Id>REQUISIO</Id>
      <Title>Atendimento de requisições</Title>
      <Order>10</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Fixed</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>false</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>CP_REQUISICOES.ATENDIMENTOREQUISICAO.GRID</EntityViewName>
  <DefaultFilterName>Pesquisar por</DefaultFilterName>
  <Mode>1</Mode>
  <UserDefinedSelectColumnVisible>true</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>(A.STATUS IN (2, 4, 6, 9, 10, 11) AND (A.TIPO IN ('O', 'T', 'P', 'R')))</UserDefinedCriteriaWhereClause>
  <FormUrl>~/aga/a/materiais/requisicoes/detalhe-requisicao/requisicao.aspx</FormUrl>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>LOTES</Id>
      <MasterWidgetId>REQUISIO</MasterWidgetId>
      <Title>Lotes</Title>
      <Order>20</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Fixed</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>EditableGrid</WidgetTypeId>
      <BootstrapCols>6</BootstrapCols>
      <XmlAttributes><![CDATA[<AdvancedEditGridAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CP_REQUISICAOATENDIMENTOLOTES.INSERIR_LOTES.GRID</EntityViewName>
  <Mode>5</Mode>
  <UserDefinedSelectColumnVisible>true</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.REQUISICAO = @CAMPO(HANDLE)</UserDefinedCriteriaWhereClause>
</AdvancedEditGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>LOTESRECLASSIFICACAOESTOQUE</Id>
      <MasterWidgetId>REQUISIO</MasterWidgetId>
      <Title>Lotes</Title>
      <Order>30</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Fixed</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>6</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>false</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>CP_REQUISICAOATENDIMENTOLOTES.RECLASSIFICACAO_ESTOQUE.GRID</EntityViewName>
  <Mode>5</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>false</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.REQUISICAO = @CAMPO(HANDLE)</UserDefinedCriteriaWhereClause>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>true</UserDefinedDisableRowSelection>
</SimpleGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
  </Widgets>
  <Resources>
    <PageResourcePortable>
      <Id>BFAD9D911CD5463A83D5EBC924CC06B9</Id>
      <ResourceType>JavaScript</ResourceType>
      <Content><![CDATA[$(() => {
    $('#ctl00_Main_REQUISIO .tools').prepend('<div class="btn-group" data-toggle="buttons"><label class="btn blue active" onclick="exibirFiltro();" id="labelExibirFiltroAtendimentoRequisicoes"><input type="radio" id="toggleExibirFiltro" name="toggleFiltro" class="toggle"> Exibir filtro </label><label style="margin-left: 3px;" class="btn blue" onclick="ocultarFiltro(true);" id="labelOcultarFiltroAtendimentoRequisicoes"><input type="radio" id="toggleOcultarFiltroAtendimentoRequisicoes" name="toggleFiltro" class="toggle"> Ocultar filtro </label></div>');

    $('#ctl00_Main_LOTES .tools, #ctl00_Main_LOTESRECLASSIFICACAOESTOQUE .tools').prepend('<div class="btn-group" data-toggle="buttons"><a id="top-OcultarLotes" class="btn command-action custom-action btn command-action blue" style="" onclick="ocultarGridLotes()"><i class="fa fa-arrow-left btn-action"></i> Ocultar</a></div>');

    var pagina = Sys.WebForms.PageRequestManager.getInstance();
    
    if (!pagina.get_isInAsyncPostBack())
    {
        pagina.add_endRequest(processarVisibilidadeFiltro);
        pagina.add_endRequest(processarVisibilidadeGridLotes);
        pagina.add_endRequest(inicializarQuantidades);
    }
    
    processarVisibilidadeFiltro();
    processarVisibilidadeGridLotes();
    inicializarQuantidades();
});

const ocultarFiltro = (fadeOut) => {
    if (fadeOut)
        $('#ctl00_Main_REQUISIO_FilterControl_FilterContainer').fadeOut(500);
    else
        $('#ctl00_Main_REQUISIO_FilterControl_FilterContainer').hide();
    
    $('#toggleOcultarFiltroAtendimentoRequisicoes').prop('checked', true);
    $('#labelOcultarFiltroAtendimentoRequisicoes').addClass('active');
    $('#labelExibirFiltroAtendimentoRequisicoes').removeClass('active');
    
    sessionStorage.setItem('TOGGLE_FILTRO_REQUISIO', "Oculto");
};

const exibirFiltro = () => {
    $('#ctl00_Main_REQUISIO_FilterControl_FilterContainer').fadeIn(500);
    sessionStorage.setItem('TOGGLE_FILTRO_REQUISIO', "Visivel");
    $("#HasFilterApplied_AtendimentoRequisicoes").val("False");
};

const processarVisibilidadeFiltro = () => {
    var estadoFiltro = sessionStorage.getItem('TOGGLE_FILTRO_REQUISIO');
    
    if (estadoFiltro === "Oculto" || $("#HasFilterApplied_AtendimentoRequisicoes").val() == "True")
        ocultarFiltro();  
};

const processarVisibilidadeGridLotes = () => {
    if ($("#VisibilidadeGridLotes").val() == "False" && $("#VisibilidadeGridLotesReclassificacao").val() == "False")
        ocultarGridLotes();
    else
        exibirGridLotes();
};

const exibirGridLotes = () => {
    var gridAExibir = $("#VisibilidadeGridLotesReclassificacao").val() == "True" ? "#LOTESRECLASSIFICACAOESTOQUE" : "#LOTES";
    var gridAOcultar = $("#VisibilidadeGridLotesReclassificacao").val() == "True" ? "#LOTES" : "#LOTESRECLASSIFICACAOESTOQUE";
	$(gridAExibir).show();
	$(gridAOcultar).hide();
	$('#REQUISIO').removeClass('col-md-12');
	$('#REQUISIO').addClass('col-md-6');
};

const ocultarGridLotes = () => {
	$("#LOTES, #LOTESRECLASSIFICACAOESTOQUE").hide();
	$('#REQUISIO').removeClass('col-md-6');
	$('#REQUISIO').addClass('col-md-12');
	$("#VisibilidadeGridLotes").val("False");
	$("#VisibilidadeGridLotesReclassificacao").val("False");
};

const conversorDecimal = value => currency(value, { separator: '.', decimal: ',', precision: 4 });

const inicializarQuantidades = () => {
    if (!$("#JsonDadosItens").val())
        return;
            
    $("#REQUISIO tbody tr").each((index, linha) => {
        var handle = $(linha).attr("handle");
        
        if (!handle)
            return;
        
        var jsonItens = JSON.parse($("#JsonDadosItens").val());
        
        var campoQuantidade = "QTDEATENDER_" + handle;
        
        $('#' + campoQuantidade).on("blur", function() {
            var jsonItens = JSON.parse($("#JsonDadosItens").val());
            jsonItens[campoQuantidade].Quantidade = conversorDecimal($(this).val()).value;
            $("#JsonDadosItens").val(JSON.stringify(jsonItens));
        });
        
        $('#' + campoQuantidade).val(conversorDecimal(jsonItens[campoQuantidade].Quantidade).format());
        $('#' + campoQuantidade).attr("readonly", jsonItens[campoQuantidade].ReadOnly);
    });
};]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
    <PageResourcePortable>
      <Id>A5AE2F2458294B0188DF6841B9FCED81</Id>
      <ResourceType>CSS</ResourceType>
      <Content><![CDATA[#LOTES th, td, #REQUISIO th, td, #LOTESRECLASSIFICACAOESTOQUE th, td {
    white-space:nowrap !important;
}

.customQuantidadeReservar {
    min-width: 160px;
}]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
  </Resources>
</PagePortable>