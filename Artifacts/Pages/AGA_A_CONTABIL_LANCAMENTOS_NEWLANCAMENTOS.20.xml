<?xml version="1.0"?>
<PagePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Title>Novo lançamento</Title>
  <Url>~/aga/a/Contabil/lancamentos/NewLancamentos.aspx</Url>
  <AutoGenerated>true</AutoGenerated>
  <EntityPermissionId />
  <TemplateId />
  <Details />
  <Id>AGA_A_CONTABIL_LANCAMENTOS_NEWLANCAMENTOS</Id>
  <Level>Benner</Level>
  <CodeFile />
  <CodeInherits>aga.a.contabil.lancamentos.lancamentosNewLancamentosPage,Benner.Corporativo.Wes.WebApp</CodeInherits>
  <Widgets>
    <PageWidgetPortable>
      <Id>TILEVALORDEBITO</Id>
      <Title>TILEVALORDEBITO</Title>
      <Order>2</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>None</PortletLayout>
      <WidgetTypeId>Tile</WidgetTypeId>
      <BootstrapCols>3</BootstrapCols>
      <XmlAttributes><![CDATA[<TileAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CT_LANCAMENTOS.CONTABEIS.CUSTOM.GRID</EntityViewName>
  <CompanyFilterMode>0</CompanyFilterMode>
  <CriteriaWhereClause>(A.DOCUMENTO = 0 AND A.ORIGEM = 1 AND A.EMPRESA = @EMPRESA AND A.LOTE = 0 AND A.NATUREZA = 'D')</CriteriaWhereClause>
  <Value>VALOR</Value>
  <Description>Valor Débito</Description>
  <Icon>fa fa-minus</Icon>
  <Color>blue</Color>
  <ValueAggregation>2</ValueAggregation>
  <TileType>1</TileType>
</TileAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>TILEVALORCREDITO</Id>
      <Title>TILEVALORCREDITO</Title>
      <Order>5</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>None</PortletLayout>
      <WidgetTypeId>Tile</WidgetTypeId>
      <BootstrapCols>3</BootstrapCols>
      <XmlAttributes><![CDATA[<TileAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CT_LANCAMENTOS.CONTABEIS.CUSTOM.GRID</EntityViewName>
  <CompanyFilterMode>0</CompanyFilterMode>
  <CriteriaWhereClause>(A.DOCUMENTO = 0 AND A.ORIGEM = 1 AND A.EMPRESA = @EMPRESA AND A.LOTE = 0 AND A.NATUREZA = 'C')</CriteriaWhereClause>
  <Value>VALOR</Value>
  <Description>Valor Crédito</Description>
  <Icon>fa fa-plus</Icon>
  <Color>red</Color>
  <ValueAggregation>2</ValueAggregation>
  <TileType>1</TileType>
</TileAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>TILEDIFERENCA</Id>
      <Title>TILEDIFERENCA</Title>
      <Order>8</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>None</PortletLayout>
      <WidgetTypeId>Tile</WidgetTypeId>
      <BootstrapCols>3</BootstrapCols>
      <XmlAttributes><![CDATA[<TileAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CT_LANCAMENTOSTILE.DATASOURCE.GRID</EntityViewName>
  <CompanyFilterMode>0</CompanyFilterMode>
  <CriteriaWhereClause>A.DOCUMENTO= 0</CriteriaWhereClause>
  <Value>DIFERENCA</Value>
  <Description>Diferença</Description>
  <Color>yellow-crusta</Color>
  <ValueAggregation>2</ValueAggregation>
  <TileType>1</TileType>
</TileAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>TILEDOCUMENTO</Id>
      <Title>TILEDOCUMENTO</Title>
      <Order>9</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>None</PortletLayout>
      <WidgetTypeId>Tile</WidgetTypeId>
      <BootstrapCols>3</BootstrapCols>
      <XmlAttributes><![CDATA[<TileAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CT_DOCUMENTOS.CUSTOM.GRID</EntityViewName>
  <CompanyFilterMode>0</CompanyFilterMode>
  <CriteriaWhereClause>A.HANDLE = 0</CriteriaWhereClause>
  <Value>DOCUMENTOCONTABIL</Value>
  <Description>Documento</Description>
  <Icon>fa fa-file</Icon>
  <Color>grey-cascade</Color>
  <ValueAggregation>0</ValueAggregation>
  <TileType>1</TileType>
</TileAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>NOVOLANAMENTO</Id>
      <MasterWidgetId>LANAMENTOS</MasterWidgetId>
      <Title>Inf. Lançamento</Title>
      <Order>10</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>AjaxForm</WidgetTypeId>
      <BootstrapCols>7</BootstrapCols>
      <XmlAttributes><![CDATA[<AjaxFormAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CT_LANCAMENTOS.NEW.CUSTOM.FORM</EntityViewName>
  <FormMode>2</FormMode>
  <IncludeRecordInRecentItems>true</IncludeRecordInRecentItems>
  <UserDefinedCriteriaWhereClause>A.HANDLE = @CAMPO(HANDLE)</UserDefinedCriteriaWhereClause>
  <UserDefinedCommandsVisible>true</UserDefinedCommandsVisible>
</AjaxFormAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>LANAMENTOS</Id>
      <Title>Lançamentos</Title>
      <Order>15</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>5</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>false</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CT_LANCAMENTOS.NEW.CUSTOM.GRID</EntityViewName>
  <Mode>0</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>CENTRODECUSTOS</Id>
      <MasterWidgetId>NOVOLANAMENTO</MasterWidgetId>
      <Title>Centro de custos</Title>
      <Order>20</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Normal</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CT_LANCAMENTOCC.NEW.CUSTOM.GRID</EntityViewName>
  <Mode>0</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>(A.LANCAMENTO = @CAMPO(HANDLE) AND A.DOCUMENTO = @CAMPO(DOCUMENTO) AND A.NATUREZA = @CAMPO(NATUREZA))</UserDefinedCriteriaWhereClause>
  <FormUrl>~/aga/a/Contabil/lancamentos/NovolancamentoCC.aspx</FormUrl>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
<CssClass>hide</CssClass>
</SimpleGridAttributes>
]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
  </Widgets>
  <Resources>
    <PageResourcePortable>
      <Id>898BDF6889D344D2A888476813B924A7</Id>
      <ResourceType>JavaScript</ResourceType>
      <Content><![CDATA[        var steps;
        $(function () {
            steps = [
                {
                element: '#NOVOLANAMENTO',
        	    title: 'Dados do lançamento.',
    			content: "Aqui estão disponíveis os campos necessários para inclusão de um novo lançamento, os de preenchimento obrigatório são marcados com '*'.",
    			placement: 'right',
                backdrop: true
            },
    		{
                element: '#portlet_LANAMENTOS',
        	    title: 'Lancamentos efetuados.',
    			content: 'Aqui estão listados os lançamentos efetuados para o documento atual.',
    			placement: 'left',
                backdrop: true
            },
    		{
                element: '#CENTRODECUSTOS',
        	    title: 'Lancamentos efetuados.',
    			content: 'Aqui ficam listados os centros de custo vinculados ao lançamento.',
    			placement: 'top',
                backdrop: true
            },
    		{
                element: '#ctl00_Main_NOVOLANAMENTO_formView_PageControl_GERAL_GERAL_DOCUMENTO_ctl01_text',
        	    title: 'Documento vinculado.',
    			content: 'Campo preenchido automaticamente, após inclusão do lançamento o sistema gera um novo documento, com base nos dados do lançamento informado.',
    			placement: 'bottom',
    			backdrop: true
            },
    		{
    			element: '#ctl00_Main_NOVOLANAMENTO_formView_PageControl_GERAL_GERAL_CONTADEBITO_ctl01_select',
        	    title: 'Conta de debito e crédito.',
    			content: 'Caso uma das contas informadas exiga um centro de custo, após inclusão do lançamento, uma nova janela será aberta, para que o usuário possa informa-lo.',
    			placement: 'top',
    			backdrop: true
    		}];


            var prm = Sys.WebForms.PageRequestManager.getInstance();
            if (!prm.get_isInAsyncPostBack()) {

                Benner.Page.addWebTourSteps(steps);
                Benner.Page.initWebTour(false);
                prm.add_endRequest(function (sender, args) {
                    $('.btn-save').click(function () {
                        ValidarCentroCustos();

                    });
                });

            }

            $.ajax({
                type: "GET",
                dataType: "json",
                url: Benner.Page.getApplicationPath() + 'lancamentos/VerificaParametrosParaDocAutomatico',  
                success: function (data) {
                    if (!data){
                        $('#ctl00_Main_NOVOLANAMENTO_toolbar').append('<div class="alert alert-warning"><strong>Atenção!</strong><p>Para utilização do formulário é necessario configurar os parâmetros contábeis de lançamento!</p><ol><li>Documento Contabil como \'Automático\'</li><li>Lote como \'Não Utiliza\'</li></ol></div>')
                        $('#ctl00_Main_NOVOLANAMENTO_toolbar > a').hide();
                    }                       
                    
                },
                error: function (xhr, textStatus, error) {
                    console.log(error);
                }               
            });



})
        var contaDebito, contaCredito;

        function ValidarCentroCustos() {

            var contaDebito = $('#ctl00_Main_NOVOLANAMENTO_formView_PageControl_GERAL_GERAL_CONTADEBITO_ctl01_select').val();
            var contaCredito = $('#ctl00_Main_NOVOLANAMENTO_formView_PageControl_GERAL_GERAL_CONTACREDITO_ctl01_select').val();
            
            var contaDebitoTexto = $('#ctl00_Main_NOVOLANAMENTO_formView_PageControl_GERAL_GERAL_CONTADEBITO_ctl01_select').text();
            
            var contaCreditoTexto = $('#ctl00_Main_NOVOLANAMENTO_formView_PageControl_GERAL_GERAL_CONTACREDITO_ctl01_select').text();

            if (contaDebito !== null || contaCredito !== null) {
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: Benner.Page.getApplicationPath() + 'lancamentos/VerificaExigeCC',
                    data: { conta: [contaCredito, contaDebito] },

                    beforeSend: function () {
                        App.blockUI({ target: '#ContentPanel', animate: true });
                    },
                    success: function (data) {
                        if ($('#ctl00_Main_LANAMENTOS_SimpleGrid').find('thead').length > 0) {
                            $('#ctl00_Main_TILEVALORDEBITO').removeClass('hide').show();
                            $('#ctl00_Main_TILEDIFERENCA').removeClass('hide').show();
                            $('#ctl00_Main_TILEVALORCREDITO').removeClass('hide').show();
                            $('#ctl00_Main_TILEDOCUMENTO').removeClass('hide').show();    
                            if (data.exige)
                            {
                                $('#ctl00_Main_CENTRODECUSTOS').removeClass('hide').show();
                                if(data.conta == contaDebito){
                                    CallModalCC(contaDebitoTexto.substring(0,contaDebitoTexto.indexOf('-')));    
                                }
                                else
                                    CallModalCC(contaCreditoTexto.substring(0,contaCreditoTexto.indexOf('-')));    
                                
                            }
                        }
                    },
                    error: function (xhr, textStatus, error) {
                        console.log(error);
                    },
                    complete: function () {
                        App.unblockUI('#ContentPanel');
                    }
                });
            }

        }

        function CallModalCC(conta) {
            var seletor = "#ctl00_Main_LANAMENTOS_SimpleGrid td:contains('{0}')".replace('{0}', conta)
            $(seletor).trigger('click');
            setTimeout(function() { __doPostBack('ctl00$Main$CENTRODECUSTOS', 'New'); }, 1500);

        }
]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
    <PageResourcePortable>
      <Id>A635E794535F4FA09F4E8353DC977F8E</Id>
      <ResourceType>CSS</ResourceType>
      <Content><![CDATA[.wes-tile .wes-default-tile, .wes-tile .wes-progress-tile, .wes-tile .wes-flat-tile {
    height: 80px !important;
    margin-bottom: 12px;
}

.dashboard-stat.dashboard-stat-v2 .visual{
    padding-top: 0px;
}

.dashboard-stat .details .number {
    padding-top: 15px;
    line-height: 0px;
}

.dashboard-stat .details .desc {
    line-height: 60px;
}

.ShowCC {
    display: block!important;
}

.tour-step-background {
    z-index: 3;
}

]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
  </Resources>
</PagePortable>