<?xml version="1.0"?>
<PagePortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Title>Cotações de compra</Title>
  <Url>~/aga/a/Suprimentos/cotacoes/cotacoes.aspx</Url>
  <AutoGenerated>true</AutoGenerated>
  <EntityPermissionId />
  <TemplateId />
  <Details />
  <Id>AGA_A_SUPRIMENTOS_COTACOES_COTACOES</Id>
  <Level>Benner</Level>
  <CodeFile />
  <CodeInherits>Benner.Corporativo.Wes.WebApp.aga.a.suprimentos.cotacoes.Cotacoes</CodeInherits>
  <Widgets>
    <PageWidgetPortable>
      <Id>REQCOTAES</Id>
      <Title>Cotações de compra</Title>
      <Order>10</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Fixed</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>12</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>false</CanUpdate>
  <CanInsert>false</CanInsert>
  <EntityViewName>CP_REQUISICAOPRODUTOS.COTACOES.GRID</EntityViewName>
  <DefaultFilterName>Padrão</DefaultFilterName>
  <Mode>1</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.STATUS = 1 AND A.TIPO = 'C' AND A.FORNECEDOR IS NOT NULL AND (A.COMPRADOR =  @~SESSAO(COMPRADOR_ATUAL_COTACOES) OR @~SESSAO(COMPRADOR_ATUAL_COTACOES) = '')</UserDefinedCriteriaWhereClause>
  <FormUrl>~/aga/a/suprimentos/cotacoes/HistoricoCotacoes.aspx</FormUrl>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
    <PageWidgetPortable>
      <Id>COTAES</Id>
      <MasterWidgetId>REQCOTAES</MasterWidgetId>
      <Title>Rodadas de cotação</Title>
      <Order>20</Order>
      <ShowTitle>true</ShowTitle>
      <PortletCssClass />
      <FontIcon />
      <Subtitle />
      <ChromeState>Fixed</ChromeState>
      <PortletLayout>Default</PortletLayout>
      <WidgetTypeId>SimpleGrid</WidgetTypeId>
      <BootstrapCols>6</BootstrapCols>
      <XmlAttributes><![CDATA[<SimpleGridAttributes>
  <CanDelete>true</CanDelete>
  <CanUpdate>true</CanUpdate>
  <CanInsert>true</CanInsert>
  <EntityViewName>CP_REQUISICAOCOTACOES.COTACOES.GRID</EntityViewName>
  <Mode>0</Mode>
  <UserDefinedSelectColumnVisible>false</UserDefinedSelectColumnVisible>
  <UserDefinedPageSize>10</UserDefinedPageSize>
  <SystemFilterOnly>false</SystemFilterOnly>
  <DisplayRowCommand>true</DisplayRowCommand>
  <CompanyFilterMode>1</CompanyFilterMode>
  <UserDefinedCriteriaWhereClause>A.COTACAO = @CAMPO(HANDLE)</UserDefinedCriteriaWhereClause>
  <FormUrl>~/aga/a/Suprimentos/cotacoes/cotacoesForm.aspx</FormUrl>
  <ShowExport>true</ShowExport>
  <UserDefinedDisableRowSelection>false</UserDefinedDisableRowSelection>
</SimpleGridAttributes>]]></XmlAttributes>
      <Level>Benner</Level>
    </PageWidgetPortable>
  </Widgets>
  <Resources>
    <PageResourcePortable>
      <Id>B93D540B0448408B9B912F1803D81246</Id>
      <ResourceType>JavaScript</ResourceType>
      <Content><![CDATA[const ocultarPainelComandosInferior = () => Benner.Page.REQCOTAES.hideFooterCommandsBar();

//A barra de comandos da tec possui javascript que implementa controle de largura automático por baixo dos panos, acionando o comando "Mais" e ocultando os comandos quando os mesmos forem sobrepassar a largura do widget. Nesta tela, porém, os comandos estão sendo diminuidos manualmente após a renderização, não sendo necessário esse comportamento. Este código oculta o botão mais caso a tec tenha inserido em seu JS por falso positivo e reexibe os comandos que foram ocultados.
const desfazerBotaoMaisTec = () => {
    $("#ctl00_Main_REQCOTAES_toolbar a[style*='display: none']").show()
    $("#ctl00_Main_REQCOTAES_toolbar .more-menu-item").hide()  
};

const incluirLegendaBotoes = () => {
    $("#ctl00_Main_REQCOTAES_toolbar, #ctl00_Main_REQCOTAES_footerCommands").find("> a").each((index, comando) => {
        var descricaoComando;
        if (comando.id == "top-CMD_ALTERARDATAFORNECEDOR") {
            descricaoComando = "Alterar data validade no portal";
        }
        $(comando).find("i").css("padding-left", "8px");
        
        if (!$(comando).attr("title"))
            $(comando).attr("title", descricaoComando);
    });  
};

const ocultarFiltro = (fadeOut) => {
    if (fadeOut)
        $('#ctl00_Main_REQCOTAES_FilterControl_FilterContainer').fadeOut(500);
    else
        $('#ctl00_Main_REQCOTAES_FilterControl_FilterContainer').hide();
    
    $('#toggleOcultarFiltroCotacoesDeCompra').prop('checked', true);
    $('#labelOcultarFiltroCotacoesDeCompra').addClass('active');
    $('#labelExibirFiltroCotacoesDeCompra').removeClass('active');
    $('#labelOcultarFiltroReqCotacoes').css('display', 'none');
    $('#labelExibirFiltroReqCotacoes').css('display', '')    
    
    sessionStorage.setItem('TOGGLE_FILTRO_REQCOTAES', "Oculto");
};

const exibirFiltro = () => {
    $('#ctl00_Main_REQCOTAES_FilterControl_FilterContainer').fadeIn(500);
    $("#HasFilterApplied_CotacoesDeCompra").val("False");
    
    $('#labelOcultarFiltroReqCotacoes').css('display', '');
    $('#labelExibirFiltroReqCotacoes').css('display', 'none');
    
    sessionStorage.setItem('TOGGLE_FILTRO_REQCOTAES', "Visivel");
};

const processarVisibilidadeFiltro = () => {
    var estadoFiltro = sessionStorage.getItem('TOGGLE_FILTRO_REQCOTAES');
    
    if (estadoFiltro === "Oculto" || $("#HasFilterApplied_CotacoesDeCompra").val() == "True")
        ocultarFiltro();  
};

const processarVisibilidadeGridRodadas = () => {
    if ($("#VisibilidadeGridRodadas").val() == "False")
        ocultarGridRodadas();
    else
        exibirGridRodadas();
};

const exibirGridRodadas = () => {
	$("#COTAES").fadeIn();
	$('#REQCOTAES').removeClass('col-md-12');
	$('#REQCOTAES').addClass('col-md-6');
	$("#VisibilidadeGridRodadas").val("True");
};

const ocultarGridRodadas = () => {
	$("#COTAES").hide();
	$('#REQCOTAES').removeClass('col-md-6');
	$('#REQCOTAES').addClass('col-md-12');
	$("#VisibilidadeGridRodadas").val("False");
};

const botoesControle = () => {
    $('#ctl00_Main_REQCOTAES_toolbar').append('<a class="btn custom-action command-action blue active" style="display: none" onclick="exibirFiltro();" id="labelExibirFiltroReqCotacoes"> Exibir filtro </a><a class="btn custom-action command-action blue" onclick="ocultarFiltro(true);" id="labelOcultarFiltroReqCotacoes"> Ocultar filtro </a>');
    
    $('#ctl00_Main_COTAES_toolbar').prepend('<div class="btn-group" data-toggle="buttons"><a id="top-OcultarLotes" class="btn command-action custom-action btn command-action blue" style="" onclick="ocultarGridRodadas()"><i class="fa fa-arrow-left btn-action"></i> Ocultar</a></div>');
};

$(() => {
    var pagina = Sys.WebForms.PageRequestManager.getInstance();
    
    if (!pagina.get_isInAsyncPostBack())
    {
        pagina.add_endRequest(processarVisibilidadeFiltro);
        pagina.add_endRequest(incluirLegendaBotoes);
        pagina.add_endRequest(desfazerBotaoMaisTec);
        pagina.add_endRequest(processarVisibilidadeGridRodadas);
        pagina.add_endRequest(ocultarPainelComandosInferior);
        pagina.add_endRequest(botoesControle);
    }
      
    incluirLegendaBotoes(); 
    processarVisibilidadeFiltro();
    processarVisibilidadeGridRodadas();
    ocultarPainelComandosInferior();
    botoesControle();
});
]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
    <PageResourcePortable>
      <Id>7BC8E9F9559C4783949ADF16B43F9FF5</Id>
      <ResourceType>CSS</ResourceType>
      <Content><![CDATA[#COTAES th, td, #REQCOTAES th, td {
    white-space: nowrap !important;
}]]></Content>
      <Level>Benner</Level>
    </PageResourcePortable>
  </Resources>
</PagePortable>