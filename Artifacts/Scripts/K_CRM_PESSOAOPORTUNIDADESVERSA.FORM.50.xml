<?xml version="1.0"?>
<ScriptPortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ViewName>K_CRM_PESSOAOPORTUNIDADESVERSA.FORM</ViewName>
  <EntityName>K_CRM_PESSOAOPORTUNIDADESVERSA</EntityName>
  <Level>Cliente</Level>
  <Scripts>
    <ScriptItemPortable>
      <FunctionName>Load</FunctionName>
      <LanguageName>IronPython</LanguageName>
      <SourceCode>def Load(widget):
    from Benner.Tecnologia.Common import EntityBase
    from Benner.Tecnologia.Common import Entities
    from Benner.Tecnologia.Common import EntityDefinition
    from Benner.Tecnologia.Common import EntityState
    from Benner.Tecnologia.Common import Entity
    from Benner.Tecnologia.Common import Criteria
    from Benner.Tecnologia.Common import Parameter
    from Benner.Tecnologia.Common import GetMode
    from Benner.Tecnologia.Common import BennerIdentity
    from Benner.Tecnologia.Common import QuerySource
    from System.Threading import Thread
    from Benner.Tecnologia.Common import BennerPrincipal

    entity = widget.Entity
    view = widget.View
    
    if entity.Fields["FILIAL"].Handle.IsValid() :
        
        criterioSql = Criteria()
        
        sql = "SELECT K_EHREVENDA FROM FILIAIS WHERE HANDLE = :HANDLE"
        criterioSql.Parameters.Add(Parameter("HANDLE", entity.Fields["FILIAL"].Handle))
        edSql = EntityDefinition.Create()
        edSql.EntitySource = QuerySource(sql)
        revenda = Entity.GetMany(edSql, criterioSql);
        
        if revenda[0].Fields["K_EHREVENDA"] == "S":
            view.FieldDefinitions["VALORREVENDA"].Visible = True

        else:
            view.FieldDefinitions["VALORREVENDA"].Visible = False;
    
    view.FieldDefinitions["CONDPAGLU"].Visible = False;
    view.FieldDefinitions["CONDPAGLUM"].Visible = False;
    view.FieldDefinitions["CONDPAGLOC"].Visible = False;
    view.FieldDefinitions["CONDPAGSERV"].Visible = False;
    view.FieldDefinitions["CONDPAGSAAS"].Visible = False;
    view.FieldDefinitions["CONDPAGBPO"].Visible = False;
    
    #if entity.Fields["HANDLE"].IsValid():
    #    oportunidade = entity.Fields["OPORTUNIDADE"];
    #    versao = entity.Fields["VERSAO"];
    #    criteria = Criteria("A.HANDLE IN (SELECT MODALIDADE FROM K_CRM_PESSOAOPORTUNIDADESVERSA WHERE OPORTUNIDADE = :OPORTUNIDADE AND VERSAO = :VERSAO)");
    #    criteria.Parameters.Add(Parameter("OPORTUNIDADE", oportunidade))
    #    criteria.Parameters.Add(Parameter("VERSAO", versao))
    #    modalidade = Entity.Get(EntityDefinition.GetByName("K_CRM_MODALIDADES"), criteria);
        
    #    if None != modalidade:
    #        if modalidade.Fields["HANDLE"].IsValid():
    #            if modalidade.Fields["LU"] == True:
    #                view.FieldDefinitions["CONDPAGLU"].Visible = True;
    #            else:
    #                view.FieldDefinitions["CONDPAGLU"].Visible = False;
    #            if modalidade.Fields["LUM"] == True:
    #                view.FieldDefinitions["CONDPAGLUM"].Visible = True;
    #            else:
    #                view.FieldDefinitions["CONDPAGLUM"].Visible = False;
    #            if modalidade.Fields["LOCACAO"] == True:
    #                view.FieldDefinitions["CONDPAGLOC"].Visible = True;
    #            else:
    #                view.FieldDefinitions["CONDPAGLOC"].Visible = False;
    #            if modalidade.Fields["ESCOPO"] == True:
    #                view.FieldDefinitions["CONDPAGSERV"].Visible = True;
    #            else:
    #                view.FieldDefinitions["CONDPAGSERV"].Visible = False;
    #            if modalidade.Fields["SAAS"] == True:
    #                view.FieldDefinitions["CONDPAGSAAS"].Visible = True;
    #            else:
    #                view.FieldDefinitions["CONDPAGSAAS"].Visible = False;
    #            if modalidade.Fields["BPO"] == True:
    #                view.FieldDefinitions["CONDPAGBPO"].Visible = True;
    #            else:
    #                view.FieldDefinitions["CONDPAGBPO"].Visible = False;
</SourceCode>
    </ScriptItemPortable>
  </Scripts>
</ScriptPortable>