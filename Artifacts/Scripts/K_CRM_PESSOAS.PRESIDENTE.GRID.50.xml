<?xml version="1.0"?>
<ScriptPortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ViewName>K_CRM_PESSOAS.PRESIDENTE.GRID</ViewName>
  <EntityName>K_CRM_PESSOAS</EntityName>
  <Level>Cliente</Level>
  <Scripts>
    <ScriptItemPortable>
      <FunctionName>Load</FunctionName>
      <LanguageName>IronPython</LanguageName>
      <SourceCode>def Load(widget):
    from System.Threading import Thread
    
    ehPresidente = Thread.CurrentPrincipal.IsInRole("K_CRM_PRESIDENTE")
    ehVicePresidente = Thread.CurrentPrincipal.IsInRole("K_CRM_VP")
    ehDiretorGeral = Thread.CurrentPrincipal.IsInRole("K_CRM_DIRETOR_GERAL")
    
    if ehPresidente == False and ehVicePresidente == False and ehDiretorGeral == False:
        widget.Hidden = True;
</SourceCode>
    </ScriptItemPortable>
    <ScriptItemPortable>
      <FunctionName>InitializeRow</FunctionName>
      <LanguageName>IronPython</LanguageName>
      <SourceCode>def InitializeRow(entity, row):
    from System.Threading import Thread
    from Benner.Tecnologia.Common import BennerIdentity
    
    ehAdmin = Thread.CurrentPrincipal.IsInRole("K_CRM_ADMIN")
    
    # ======= FASES ===========
    #   fase 1 = Suspecção, 
    #   fase 2 = Prospecção, 
    #   fase 3 = Negociação,  
    #   fase 4 = Cliente,
    #   fase 5 = Inativo,
    # ======= END FASES =======
    
    # ======= STATUS ===========
    #   status 1 = Não integrado, 
    #   status 2 = Integrado
    # ======= END FASES =======
    
    faseNome = entity.Fields["FASE"].Instance.Fields["NOME"]
    fase = int(entity.Fields["FASE"].Handle.Value)
    subfase = int(entity.Fields["SUBFASE"].Handle.Value)
    subfaseNome = entity.Fields["SUBFASE"].Instance.Fields["NOME"]
    
    usuario = BennerIdentity.Current.UserHandle
    responsavel = entity.Fields["USUARIORESPONSAVEL"].Handle
    executivo = entity.Fields["USUARIOEXECUTIVO"].Handle
    
    if row.GetCustomCommand("cmdIntegraExact") != None:
        row.GetCustomCommand("cmdIntegraExact").Enabled = None;
    
    if row.GetCustomCommand("cmdVerificaExact") != None:
        row.GetCustomCommand("cmdVerificaExact").Enabled = None;
    
    if row.GetCustomCommand("cmdSincronizaLead") != None:
        row.GetCustomCommand("cmdSincronizaLead").Enabled = None;
   
    if row.GetCustomCommand("cmdQualificar") != None:
        row.GetCustomCommand("cmdQualificar").Enabled = (usuario == responsavel and faseNome == "Suspecção" and subfaseNome == "A qualificar" );
    
    if row.GetCustomCommand("cmdTrasferirLead") != None:
        row.GetCustomCommand("cmdTrasferirLead").Enabled = (usuario == responsavel or ehAdmin == True);
    
    if row.GetCustomCommand("cmdTrasferirExecutivo") != None:
        row.GetCustomCommand("cmdTrasferirExecutivo").Enabled = (usuario == executivo or ehAdmin == True);
           
    if row.GetCustomCommand("cmdAtividadesPendentes") != None:
        row.GetCustomCommand("cmdAtividadesPendentes").Enabled = (faseNome != "Ex cliente" and faseNome != "Prospecção Futura") #(fase not in [5] );
    
    if row.GetCustomCommand("cmdRecuperarLead") != None:
        row.GetCustomCommand("cmdRecuperarLead").Enabled = (faseNome == "Ex cliente" or faseNome == "Prospecção Futura") #(fase in [5] );
    
    if row.GetCustomCommand("cmdGrupoEmpresarial") != None:
        row.GetCustomCommand("cmdGrupoEmpresarial").Enabled = (entity.Fields["GRUPOEMPRESARIAL"].Handle.IsValid());
        
    if entity.Fields["USUARIORESPONSAVEL"].Handle != usuario:
        if row.GetCustomCommand("cmdEdit") != None:
            row.GetCustomCommand("cmdEdit").Enabled = False;
        
    if fase in [1]:
        row.GetCellByName("FASE").Text = "&lt;span style='width:120px; height:25px; padding-top: 5px; display: inline-block; text-align: center' class='label bg-purple-wisteria'&gt;"+faseNome+"&lt;/span&gt;"
        
    if fase in [2]:
        row.GetCellByName("FASE").Text = "&lt;span style='width:120px; height:25px; padding-top: 5px; display: inline-block; text-align: center' class='label bg-yellow-casablanca'&gt;"+faseNome+"&lt;/span&gt;"
        
    if fase in [3]:
        row.GetCellByName("FASE").Text = "&lt;span style='width:120px; height:25px; padding-top: 5px; display: inline-block; text-align: center' class='label bg-blue-sharp'&gt;"+faseNome+"&lt;/span&gt;"
        
    if fase in [4]:
        row.GetCellByName("FASE").Text = "&lt;span style='width:120px; height:25px; padding-top: 5px; display: inline-block; text-align: center' class='label bg-red-intense'&gt;"+faseNome+"&lt;/span&gt;"  
        
    if fase in [5]:
        row.GetCellByName("FASE").Text = "&lt;span style='width:120px; height:25px; padding-top: 5px; display: inline-block; text-align: center' class='label bg-green-haze'&gt;"+faseNome+"&lt;/span&gt;"     
        
    if fase in [6]:
        row.GetCellByName("FASE").Text = "&lt;span style='width:120px; height:25px; padding-top: 5px; display: inline-block; text-align: center' class='label bg-green-jungle'&gt;C/ Oportunidade&lt;/span&gt;"
    
    if entity.Fields["GRUPOEMPRESARIAL"].Handle.IsValid():
        row.GetCellByName("FASE").Text = "&lt;span style='margin-left:40%'&gt;-&lt;/span&gt;" 
        row.GetCellByName("SUBFASE").Text = "&lt;span style='margin-left:40%'&gt;-&lt;/span&gt;"   
</SourceCode>
    </ScriptItemPortable>
  </Scripts>
</ScriptPortable>