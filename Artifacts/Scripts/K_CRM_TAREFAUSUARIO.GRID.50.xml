<?xml version="1.0"?>
<ScriptPortable xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ViewName>K_CRM_TAREFAUSUARIO.GRID</ViewName>
  <EntityName>K_CRM_TAREFAUSUARIO</EntityName>
  <Level>Cliente</Level>
  <Scripts>
    <ScriptItemPortable>
      <FunctionName>InitializeRow</FunctionName>
      <LanguageName>IronPython</LanguageName>
      <SourceCode>def InitializeRow(entity, row):
    from Benner.Tecnologia.Common import BennerIdentity
    from Benner.Tecnologia.Common import BennerContext
    
    usuario = BennerIdentity.Current.UserHandle
    status  = int(entity.Fields["STATUS"].Value)
    statusNome  = entity.Fields["STATUS"].Text
    tipo = int(entity.Fields["TIPO"].Value);
    handleResponsavel = entity.Fields["RESPONSAVEL"].Handle
    handleUsuario = BennerContext.Security.GetLoggedUserHandle()
    
    if row.GetCustomCommand("cmdConcluirAtividade") != None:
        row.GetCustomCommand("cmdConcluirAtividade").Enabled  = status in [1] and entity.Fields["RESPONSAVEL"].Handle == usuario;
    
    if row.GetCustomCommand("cmdCancelarAtividade") != None:
        row.GetCustomCommand("cmdCancelarAtividade").Enabled  = status in [1] and entity.Fields["RESPONSAVEL"].Handle == usuario;
    
    if row.GetCustomCommand("cmdReagendarAtividade") != None:
        row.GetCustomCommand("cmdReagendarAtividade").Enabled = status in [1] and entity.Fields["RESPONSAVEL"].Handle == usuario;
    
    if row.GetCustomCommand("Edit") != None:
        if entity.Fields["RESPONSAVEL"].Handle != usuario or status not in [1]:
            row.GetCustomCommand("Edit").Enabled = False;
            
    if tipo in [1,2] and status in [1] and handleResponsavel == handleUsuario:
        row.GetCustomCommand("CmdConcluir").Enabled = True;
        row.EditCommand.Visible = False;
    else:
        row.GetCustomCommand("CmdConcluir").Enabled = False;
        row.EditCommand.Visible = False;
    
    if status in [1]:
        row.GetCellByName("STATUS").Text = "&lt;span class='label bg-red'&gt;"+statusNome+"&lt;/span&gt;"
        
    if status in [2]:
        row.GetCellByName("STATUS").Text = "&lt;span class='label bg-grey-salt'&gt;"+statusNome+"&lt;/span&gt;"
        
    if status in [3]:
        row.GetCellByName("STATUS").Text = "&lt;span class='label bg-grey'&gt;"+statusNome+"&lt;/span&gt;"
</SourceCode>
    </ScriptItemPortable>
    <ScriptItemPortable>
      <FunctionName>Load</FunctionName>
      <LanguageName>IronPython</LanguageName>
      <SourceCode>def Load(widget):
    from System.Threading import Thread
    from Benner.Tecnologia.Common import BennerPrincipal
    
    activeRole = BennerPrincipal.Current.ActiveRole

    ehGerenteCanais = activeRole == "K_CRM_GERENTE_CANAIS_V2" #Thread.CurrentPrincipal.IsInRole("K_CRM_GERENTE_CANAIS_V2")
    ehDiretorRegional = activeRole == "K_CRM_DIRETOR_REGIONAL" #Thread.CurrentPrincipal.IsInRole("K_CRM_DIRETOR_REGIONAL")
    ehAdmin = activeRole == "K_CRM_ADMIN" #Thread.CurrentPrincipal.IsInRole("K_CRM_ADMIN") 
    ehGerenteRelacionamento = activeRole == "K_CRM_GERENTE_RELACIONAMENTO" #Thread.CurrentPrincipal.IsInRole("K_CRM_GERENTE_RELACIONAMENTO")
    ehHeadVertical = activeRole == "K_CRM_DIRETORVERTICAL" #Thread.CurrentPrincipal.IsInRole("K_CRM_DIRETORVERTICAL")
    ehGerenteProdutos = activeRole == "K_CRM_GERENTE_PRODUTOS" #Thread.CurrentPrincipal.IsInRole("K_CRM_GERENTE_PRODUTOS")
    ehPresidente = activeRole == "K_CRM_PRESIDENTE" #Thread.CurrentPrincipal.IsInRole("K_CRM_PRESIDENTE")
    ehAssistenteComercial = activeRole == "K_CRM_ASSISTENTE_COMERCIAL" #Thread.CurrentPrincipal.IsInRole("K_CRM_ASSISTENTE_COMERCIAL")
    
    if ehGerenteCanais or ehDiretorRegional or ehAdmin or ehGerenteRelacionamento or ehHeadVertical or ehGerenteProdutos or ehPresidente or ehAssistenteComercial:
        widget.Hidden = True
    else:
        widget.Hidden = False
</SourceCode>
    </ScriptItemPortable>
  </Scripts>
</ScriptPortable>